
<!DOCTYPE html>

<html>

<head>

<meta charset="UTF-8">
<title>üîí Thalia</title>

<script src="https://nyteowldave.github.io/chachi/api/tigg.js"></script>
<script src="https://nyteowldave.github.io/chachi/api/legends.js"></script>
<script src="https://nyteowldave.github.io/chachi/api/thor.js"></script>
<script src="https://nyteowldave.github.io/chachi/api/joni.js"></script>
<script src="https://nyteowldave.github.io/chachi/api/editables.js"></script>
<script src="https://nyteowldave.github.io/chachi/api/energize.js"></script>
<script src="https://nyteowldave.github.io/chachi/api/bonfire.js"></script>

<style>

/* Styles for ReText Pages */
@import url("./style/rt/std.css");

/* Styles for Morning Swill Pages */
@import url("./style/swill.css");

/* Styles for Tilly Pages */
@import url("./style/tilly.css");

/* Thalia Specific Styles */
@import url("./style/thalia.css");

</style>

<style>
#version_fieldset {
    box-shadow : 0 0 4ch gold;
    background : #000 !important;
    margin-top : 10ch;
    padding : 4ch;
}
#version_table {
    margin : 0 !important;
    min-width : 40ch;
}
button.bar {
    display : inline-block  !important;
    border  : none          !important;
    outline : none     !important;
    font-size  : 11pt  !important;
    background : #EE99 !important;
    margin        : 4px !important;
    padding       : 3px !important;
    padding-left  : 1ch !important;
    padding-right : 1ch !important;
}
button.bar:hover {
    box-shadow : 0 0 1ch black;
    cursor : pointer;
}
</style>

</head>


<h2>
    <a href="https://nyteowldave.github.io/" id="title" title="üè† Home Site">üè† Home</a>
    <button class="bar" onclick="showVersionDetails()" title="üè† Version">üè† Version</button>
</h2>

<div center>

<style>

button {
    text-shadow : 0px 0px 5px #040414;
}

[dot], 
.dot {
    display     : inline-block;
    min-width   : 4.3ch !important;
    min-height  : 4.3ch !important;
    text-align  : center;
    padding     : 0;
    line-height : 3.3ch !important;
    border-radius : 100%;
}

</style>

<style>

button:hover ,
a:hover {
    animation : blossom linear 0.2s forwards !important;
}

@keyframes blossom {
    from {
        transform : scale( 1.0 );
    }
    to {
        transform : scale( 1.25 );
        opacity : 0.85;
    }
}

</style>

<script>

function say( s, silent ) {
    ( sop = gid( 'sop' ) )
    . value = String( s );
    if ( silent ) { return; }
    presentSOP();
}

function mention( s, silent ) {
    sop = gid( 'sop' );
    sop . value = ( 
        [ sop.value, s ] . join( "\n" )
    );
    if ( silent ) { return; }
    presentSOP();
}

function presentSOP() {    
    gid( 'sop-owner' ).showPopover();
}

function clearSOP() {
    ( sop = gid( 'sop' ) )
    . value = "";
}

</script>

<div popover="auto" id="sop-owner">
  <textarea id="sop" wrap="off" spellcheck="false" style="width: 558px; height: 281px;"></textarea>
</div>

<div class="menu">
  <button class="dot" title="üîò Show Log" onclick="presentSOP()">üîò</button>
  <button class="dot" title="üóë Clear Log" onclick="clearSOP()">üóë</button>
  <button class="dot" title="üñºÔ∏è Show Icon" onclick="presentIcon()">üñºÔ∏è</button>
</div>

<script>
function presentIcon() {
    let url="./favicon.ico";
    let opts="left=10,top=10,width=320,height=400";
    let dlg=window.open(url, url, opts);
}
</script>

</div>

<div center>

<style>
@import url("./style/siox.css");
@keyframes bloom {
    0%   { transform  : scale( 1.00 ); }
    50%  { transform  : scale( 1.17 ); }
    100% { transform  : scale( 1.22 ); }
}
legend {
    display    : inline-block;
    background : transparent !important;
}
input {
    font       : 12pt monospace;
    width      : 24em;
    padding    : 0.5ch;
    padding-left  : 1.5ch;
    padding-right : 1.5ch;
}
input:focus,
.menu button:focus {
    background : #000 !important;
    color      : #AFD !important;
    box-shadow : 0px 0px 1.2ch #020212;
    animation  : 0.12s bloom linear forwards;
}
input:hover,
.menu button:hover {
    box-shadow : 0px 0px 1.2ch gold;
}
input ,
.menu button {
    border : none;
    background : #687 !important;
    color      : #000 !important;
    border-radius : 3ch;
    display    : inline-block;
    outline    : none;
}
.menu, .settings {
    margin-top : 1.5ch;
}
[decal] {
    display : inline-block;
    text-shadow : 0px 0px 11px gold;
    cursor : pointer;
    user-select : none;
}
[decal]:hover {
    transform : scale( 1.22 );
}
</style>

<script>
doc = document;
// Same as gid
ebi =( id )=> doc.getElementById( id );
// CONFLICTS with other implementations
// This is the resolve function, not gad
gad =( ed )=> ( ( ed instanceof Object ) ? ed : gid( ed ) );
// PROPER IMPLEMENTATION :
// gad =( o )=> ( e instanceof Object )
// resolve =( o )=> ( gad( o ) ? o : gid( o ) )
</script>
<script>
function showKeyCount( n ) {
    gid( 'key-count' )
    . textContent = String(
        Math.floor( n ) || 0
    );
}
</script>
<script>
function getStoreKey() {
    return setStoreKey(
        gid( 'store-key' )
        . value
    );
}
</script>
<script>
function setStoreKey( key ) {
    return (
        gid( 'store-key' )
        . value = (
            key.trim() || document.title
        )
    );
}
</script>
<script>
function noStore() {
    return ( null === localStorage );
}
</script>
<script>
function getStoreKeys() {
    if ( noStore() ) { 
        return [ getStoreKey() ];
    }
    let keys = [];
    let store = localStorage;
    if ( store !== null ) {
        while ( keys.length < 42 ) {
            let k = store.key( keys.length );
            if ( k === null ) break;
            keys.push( k );
        }
    }
    return keys;
}
</script>
<script>
function setStoreKeys( keys ) {
    function option( k ) {
        let o = document.createElement( 'option' );
        o . value = k;
        list . appendChild( o );
    }
    let list = gid( 'store-keys' );
    list.innerHTML = "";
    let key  = getStoreKey();
    keys = ( keys || getStoreKeys() )
    if ( key ) {
        if (! keys.includes( key ) ) {
            keys.push( key );
        }
     }
    keys . forEach( option );
    showKeyCount( keys.length );
}
</script>
<script>
function on_Read_Keys() {
    let keys = getStoreKeys();
    setStoreKeys( keys );
    ( sip = gid( 'sip' ) )
    . value = ( 
        keys
        . map( k => ( `üîë ${k}` ) )
        . join( "\n" )
    );
}
</script>
<script>
function on_Refresh_Keys() {
    setStoreKeys( getStoreKeys() );
}
</script>
<script>
function on_Read_Store() {
    if ( noStore() ) { return; }
    jsn = o => JSON.stringify( o, 0, 2 );
    ( sip = gid( 'sip' ) )
    . value = ( jsn( localStorage ) );
}
</script>
<script>
function on_Read_Value() {
    if ( noStore() ) { return; }
    let v = localStorage . getItem( getStoreKey() );
    if ( v === null ) { return; }
    ( sip = gid( 'sip' ) ) . value = v;
}
</script>
<script>
function on_Write_Value() {
    if ( noStore() ) { return; }
    localStorage . setItem( 
        getStoreKey() ,
        ( sip = gid( 'sip' ) ) . value
    );
}
</script>
<script>
function on_Save() {
    try {
        let input;
        let k = (
            ( input = gid( 'filename' ) )
            . value
            . trim()
        );
        input.value = (
            rico(
                ( ( sip = gid( 'sip' ) ) . value ) ,
                ( k )
            )
        )
        . anchor
        . download;
    } catch ( e ) {
        console.error( e );
        mention( e.message );
    }
}
</script>
<script>
function composeAction( button ) {
    let t = ( 
        button
        . textContent
        . trim()
    );
    let parts = ( t . split( " " ) );
    let decal = parts . shift();
    t = ( parts . join( "_" ) );
    return ( [ "on_", t, "()" ] .join( "" ) );
}
</script>
<script>
function rst( span ) { // Reset Gadget Value
    let attr = k => span.getAttribute( k );
    function rstName() {
        gid( 'filename' ) . value = attr( 'filename' );
    }
    function rstKey() {
        setStoreKey( attr( 'key' ) );
    }
    switch ( span.textContent.trim() ) {
    case "üìÉ" : return rstName();
    case "üîë" : return rstKey ();
    }
}
</script>
<script>
function zap( button ) { // Button Click Event
    try {
        let js;
        mention( js = composeAction( button ), true );
        window.eval( js );
    } catch ( e ) {
        console.error( e );
        mention( e.message );
    }
}
// üîí üîè üîì üîê üîë üì§ üì• ‚è´ üìÉ üíæ
</script>

<fieldset>
<legend>
  <span onclick="rst(this)" decal="" title="Reset Filename" filename="thalia-download.json">üìÉ</span>
  <input type="url" id="filename" value="thalia-download.json">
</legend>
<textarea id="sip" class="siox" wrap="off" spellcheck="false"></textarea>
</fieldset>
<div class="menu">
  <button onclick="zap(this)">‚è´ Read Keys</button>
  <button onclick="zap(this)">‚è´ Read Store</button>
  <button onclick="zap(this)">üíæ Save</button>
</div>
<div class="menu">
  <button onclick="zap(this)">üîì Read Value</button>
  <button onclick="zap(this)">üîè Write Value</button>
  <button onclick="zap(this)">üîê Refresh Keys</button>
</div>
<div class="settings">
  <span decal="" title="Reset Key" onclick="rst(this)" key="Thalia Decals">üîë</span>
  <input list="store-keys" id="store-key" value="Thalia Decals" placeholder="üîë">
<!-- 
https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/datalist
-->
  <datalist id="store-keys">
    <option value="Thalia Decals"></option>
  </datalist>
  <span id="key-count" title="Key Count">0</span>
</div>
</div>

<fieldset id="version_fieldset" popover="auto">
<legend>Version Details</legend>
<table id="version_table">
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Updated</td>
<td>2026-JAN-27</td>
</tr>
<tr>
<td>Version</td>
<td>2.0.0</td>
</tr>
</tbody>
</table>
<script>
function showVersionDetails() {
    try {
        let elem   = version_fieldset;
        let action = elem.showPopover;
        if ( "function" === typeof action ) {
            elem.showPopover();
        }
    } catch ( e ) { 
        alert ( e );
        throw ( e );
    }
}
</script>
<script>
// addEventListener( "load", showVersionDetails );
</script>
</fieldset>

<div center>
<details>
<summary>Navigation</summary>
<nav id="navbar"></nav>
<script>
function populateNavBar( links ) {
    function addLink( title, hint, address ) {
        let d = document; let a = d.createElement( "A" );
        a.textContent = title;
        a.title = hint;
        a.href = address;
        navbar.appendChild( a );
    }
    navbar.innerHTML = "";
    links.forEach( link => { 
        let title   = link[ 0 ];
        let hint    = link[ 1 ];
        let address = link[ 2 ];
        addLink( title, hint, address );
    } );
}
</script>
</details>
</div>

<footer id="footer">
  <div id="messages">(pending)</div>
</footer>

<script>

const AppLinks = [
    [ // [0] Title , [1] Hint , [2] Address
          "Web APIs"
        , "Web APIs ~ Mozilla Developer Network"
        , "https://developer.mozilla.org/en-US/docs/Web/" 
    ] ,
    [ // [0] Title , [1] Hint , [2] Address
          "Storage Class"
        , "Storage Class ~ Mozilla Developer Network"
        , "https://developer.mozilla.org/en-US/docs/Web/" 
    ] ,
];

addEventListener( "load", function(e) {
    populateNavBar( AppLinks );
    messages.innerText = "Ready for Action!";
} );

</script>

<script>
let todo_doc = (`
1) Update Store Keys after write entry
2) Komodo for Tabs , Run Script , Zoom Editor
3) Label for Filename Should Read Current Store Key
4) Button to Copy Store Key to Filename Input
5) Run Button (for Scripts)
6) Why the CSS load error messages still happen???
`);
</script>

<script>
function komodo( ev ) {
    let o = ev.target;
    if ( o.nodeName !== "TEXTAREA" ) return;
    function mine() {
        ev.stopPropagation();
        ev.preventDefault();
    }
    let code = ev.keyCode;
    if ( [ 16, 17, 18, 19 ].includes( code ) ) {
        return;
    } 
    if ( ev.ctrlKey  ) return;
    if ( ev.metaKey  ) return;
    if ( ev.shiftKey ) return;
    if ( ev.altKey ) {
        if ( code === 13 ) {
            return run( o );
        }
        if ( code === asc( "F" ) ) {
            return friends( o );
        }
        if ( code === asc( "K" ) ) {
            return storeKeys( o );
        }
        if ( code === asc( "X" ) ) {
            return swap( o );
        }
        if ( code === asc( "Z" ) ) {
            return zoom( o );
        }
        return;
    }
    if ( code === 9 ) {
        return insert( o, "\t" );
    }
    function analyze() {
        let ed = this;
        let id = [ "Editor" , ed.id     ];
        let ip = [ "Input"  , ed.input  ];
        let op = [ "Output" , ed.output ];
        let er = [ "Error"  , ed.error  ];
        let con = console;
        con.group( "Script Results" );
        con.table( [ id, ip, op, er ] );
        con.groupEnd();
    }
    function run( ed ) {
        try {
            mine();
            ed.error  = "";
            ed.input  = ed.value;
            ed.output = window.eval( ed.input );
        } catch( e ) {
            ed.output = "";
            ed.error  = e.message;
            bummer( e );
        } finally {
            ed.analyze = analyze;
        }
    }
    function zoom( ed ) {
        try {
            mine();
            if ( "function" === typeof ed.requestFullscreen ) {
                ed.requestFullscreen();
            }
        } catch( e ) {
            bummer( e );
        }
    }
    function friends( ed ) {
        try {
            mine();
            let friend =( k )=> ( `üë• ${k}` );
            ed.value = (
                Object
                . keys( FriendMap )
                . map( friend )
                . join( "\n")
            );
        } catch( e ) {
            bummer( e );
        }
    }
    function storeKeys( ed ) {
        try {
            mine();
            ed.value = (
                keyss() . join( "\n")
            );
        } catch( e ) {
            bummer( e );
        }
    }
    function swap( ed ) {
        try {
            mine();
            let memo = ( ed.memo );
            ed.memo = ed.value;
            ed.value = ( memo || "" );
        } catch( e ) {
            bummer( e );
        }
    }
    function insert( ed, t ) {
        try {
            mine();
        } catch( e ) {
            bummer( e );
        }
    }
    function asc( ch ) {
        return String( ch ).trim().charCodeAt( 0 );
    }
    function bummer( e ) {
        console.error( e );
        if ( "object" === typeof messages ) {
            messages.innerText = e.message;
            return;
        }
        alert( e );
    }
}
</script>

<script>
addEventListener( "keydown", komodo );
</script>

</body>
</html>

