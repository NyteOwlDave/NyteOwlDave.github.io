
<!DOCTYPE html>

<html>

<head>

<meta charset="UTF-8">
<title>Thalia</title>

<style>

/* Styles for ReText Pages */
@import url("./style/rt/std.css");

/* Styles for Morning Swill Pages */
@import url("./style/swill.css");

/* Styles for Tilly Pages */
@import url("./style/tilly.css");

/* Thalia Specific Styles */
@import url("./style/thalia.css");

</style>

</head>


<h1>
    <a href="https://nyteowldave.github.io/" id="title" title="Home Site">Home</a>
</h1>

<div center>

<style>

button {
    text-shadow : 0px 0px 5px #040414;
}

[dot], 
.dot {
    display     : inline-block;
    min-width   : 4.3ch !important;
    min-height  : 4.3ch !important;
    text-align  : center;
    padding     : 0;
    line-height : 3.3ch !important;
    border-radius : 100%;
}

</style>

<script>

function say( s, silent ) {
    ( sop = gid( 'sop' ) )
    . value = String( s );
    if ( silent ) { return; }
    presentSOP();
}

function mention( s, silent ) {
    sop = gid( 'sop' );
    sop . value = ( 
        [ sop.value, s ] . join( "\n" )
    );
    if ( silent ) { return; }
    presentSOP();
}

function presentSOP() {    
    gid( 'sop-owner' ).showPopover();
}

function clearSOP() {
    ( sop = gid( 'sop' ) )
    . value = "";
}

</script>

<div popover="auto" id="sop-owner">
  <textarea id="sop" wrap="off" spellcheck="false" style="width: 558px; height: 281px;"></textarea>
</div>

<div class="menu">
  <button class="dot" title="Show Log" onclick="presentSOP()">ğŸ”˜</button>
  <button class="dot" title="Clear Log" onclick="clearSOP()">ğŸ—‘</button>
</div>

</div>

<div center>
<style>
@import url("./style/siox.css");
@keyframes bloom {
    0%   { transform  : scale( 1.00 ); }
    50%  { transform  : scale( 1.17 ); }
    100% { transform  : scale( 1.22 ); }
}
legend {
    display    : inline-block;
    background : transparent !important;
}
input {
    font       : 12pt monospace;
    width      : 24em;
    padding    : 0.5ch;
    padding-left  : 1.5ch;
    padding-right : 1.5ch;
}
input:focus,
.menu button:focus {
    background : #000 !important;
    color      : #AFD !important;
    box-shadow : 0px 0px 1.2ch #020212;
    animation  : 0.12s bloom linear forwards;
}
input:hover,
.menu button:hover {
    box-shadow : 0px 0px 1.2ch gold;
}
input ,
.menu button {
    border : none;
    background : #687 !important;
    color      : #000 !important;
    border-radius : 3ch;
    display    : inline-block;
    outline    : none;
}
.menu, .settings {
    margin-top : 1.5ch;
}
[decal] {
    display : inline-block;
    text-shadow : 0px 0px 11px gold;
    cursor : pointer;
    user-select : none;
}
[decal]:hover {
    transform : scale( 1.22 );
}
</style>
<script src="./api/rico.js"></script>
<script>
doc = document;
gid = id => doc.getElementById( id );
// CONFLICTS with other implementations
// This is the resolve function, not gad
gad = ed => ( ( ed instanceof Object ) ? ed : gid( ed ) );
// PROPER IMPLEMENTATION :
// gad =( o )=> ( e instanceof Object )
// resolve =( o )=> ( gad( o ) ? o : gid( o ) )
</script>
<script>
function showKeyCount( n ) {
    gid( 'key-count' )
    . textContent = String(
        Math.floor( n ) || 0
    );
}
</script>
<script>
function getStoreKey() {
    return setStoreKey(
        gid( 'store-key' )
        . value
    );
}
</script>
<script>
function setStoreKey( key ) {
    return (
        gid( 'store-key' )
        . value = (
            key.trim() || document.title
        )
    );
}
</script>
<script>
function noStore() {
    return ( null === localStorage );
}
</script>
<script>
function getStoreKeys() {
    if ( noStore() ) { 
        return [ getStoreKey() ];
    }
    let keys = [];
    let store = localStorage;
    if ( store !== null ) {
        while ( keys.length < 42 ) {
            let k = store.key( keys.length );
            if ( k === null ) break;
            keys.push( k );
        }
    }
    return keys;
}
</script>
<script>
function setStoreKeys( keys ) {
    function option( k ) {
        let o = document.createElement( 'option' );
        o . value = k;
        list . appendChild( o );
    }
    let list = gid( 'store-keys' );
    list.innerHTML = "";
    let key  = getStoreKey();
    keys = ( keys || getStoreKeys() )
    if ( key ) {
        if (! keys.includes( key ) ) {
            keys.push( key );
        }
     }
    keys . forEach( option );
    showKeyCount( keys.length );
}
</script>
<script>
function on_Read_Keys() {
    let keys = getStoreKeys();
    setStoreKeys( keys );
    ( sip = gid( 'sip' ) )
    . value = ( 
        keys
        . map( k => ( `ğŸ”‘ ${k}` ) )
        . join( "\n" )
    );
}
</script>
<script>
function on_Refresh_Keys() {
    setStoreKeys( getStoreKeys() );
}
</script>
<script>
function on_Read_Store() {
    if ( noStore() ) { return; }
    jsn = o => JSON.stringify( o, 0, 2 );
    ( sip = gid( 'sip' ) )
    . value = ( jsn( localStorage ) );
}
</script>
<script>
function on_Read_Value() {
    if ( noStore() ) { return; }
    let v = localStorage . getItem( getStoreKey() );
    if ( v === null ) { return; }
    ( sip = gid( 'sip' ) ) . value = v;
}
</script>
<script>
function on_Write_Value() {
    if ( noStore() ) { return; }
    localStorage . setItem( 
        getStoreKey() ,
        ( sip = gid( 'sip' ) ) . value
    );
}
</script>
<script>
function on_Save() {
    try {
        let input;
        let k = (
            ( input = gid( 'filename' ) )
            . value
            . trim()
        );
        input.value = (
            rico(
                ( ( sip = gid( 'sip' ) ) . value ) ,
                ( k )
            )
        )
        . anchor
        . download;
    } catch ( e ) {
        console.error( e );
        mention( e.message );
    }
}
</script>
<script>
function composeAction( button ) {
    let t = ( 
        button
        . textContent
        . trim()
    );
    let parts = ( t . split( " " ) );
    let decal = parts . shift();
    t = ( parts . join( "_" ) );
    return ( [ "on_", t, "()" ] .join( "" ) );
}
</script>
<script>
function rst( span ) { // Reset Gadget Value
    let attr = k => span.getAttribute( k );
    function rstName() {
        gid( 'filename' ) . value = attr( 'filename' );
    }
    function rstKey() {
        setStoreKey( attr( 'key' ) );
    }
    switch ( span.textContent.trim() ) {
    case "ğŸ“ƒ" : return rstName();
    case "ğŸ”‘" : return rstKey ();
    }
}
</script>
<script>
function zap( button ) { // Button Click Event
    try {
        let js;
        mention( js = composeAction( button ), true );
        window.eval( js );
    } catch ( e ) {
        console.error( e );
        mention( e.message );
    }
}
// ğŸ”’ ğŸ” ğŸ”“ ğŸ” ğŸ”‘ ğŸ“¤ ğŸ“¥ â« ğŸ“ƒ ğŸ’¾
</script>
<fieldset>
<legend>
  <span onclick="rst(this)" decal="" title="Reset Filename" filename="thalia-download.json">ğŸ“ƒ</span>
  <input type="url" id="filename" value="thalia-download.json">
</legend>
<textarea id="sip" class="siox" wrap="off" spellcheck="false"></textarea>
</fieldset>
<div class="menu">
  <button onclick="zap(this)">â« Read Keys</button>
  <button onclick="zap(this)">â« Read Store</button>
  <button onclick="zap(this)">ğŸ’¾ Save</button>
</div>
<div class="menu">
  <button onclick="zap(this)">ğŸ”“ Read Value</button>
  <button onclick="zap(this)">ğŸ” Write Value</button>
  <button onclick="zap(this)">ğŸ” Refresh Keys</button>
</div>
<div class="settings">
  <span decal="" title="Reset Key" onclick="rst(this)" key="Thalia Decals">ğŸ”‘</span>
  <input list="store-keys" id="store-key" value="Thalia Decals" placeholder="ğŸ”‘">
<!-- 
https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/datalist
-->
  <datalist id="store-keys">
    <option value="Thalia Decals"></option>
  </datalist>
  <span id="key-count" title="Key Count">0</span>
</div>
</div>

<div center>
<details>
<summary>Navigation</summary>
<nav id="navbar"></nav>
<script>
function populateNavBar( links ) {
    function addLink( title, hint, address ) {
        let d = document; let a = d.createElement( "A" );
        a.textContent = title;
        a.title = hint;
        a.href = address;
        navbar.appendChild( a );
    }
    navbar.innerHTML = "";
    links.forEach( link => { 
        let title   = link[ 0 ];
        let hint    = link[ 1 ];
        let address = link[ 2 ];
        addLink( title, hint, address );
    } );
}    
</script>
</details>
</div>

<script>

const AppLinks = [    
    [ // [0] Title , [1] Hint , [2] Address  
          "Web APIs"
        , "Web APIs ~ Mozilla Developer Network"
        , "https://developer.mozilla.org/en-US/docs/Web/" 
    ]
];

addEventListener( "load", function(e) {
    populateNavBar( AppLinks );
} );

</script>

<script>
let todo_doc = (`
1) Update Store Keys after write entry
2) Komodo for Tabs , Run Script , Zoom Editor
3) Label for Filename Should Read Current Store Key
4) Button to Copy Store Key to Filename Input
5) Run Button (for Scripts)
6) Why the CSS load error messages still happen???
`);
</script>

</body>
</html>